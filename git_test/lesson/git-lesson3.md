# git初心者への道 Level 3

初登場するコマンド: reset, show, revert

## 1. インデックスにaddしたものを戻す

```
$ git add .
```

修正をaddします。

あ！やっぱりやめたい。やり直したい。人生やり直したい。    
gitは人は必ずミスをするという指針の元に設計されており、操作を取り消す方法が豊富に用意されています。

ただし、バージョン管理において、操作を取り消す＝履歴を書き換える    
ということが何を意味するのか、しっかり理解した上で作業してください。

インデックスへのaddを取りやめるには下記のコマンドを利用します。

```
$ git reset HEAD
```

ワーキングツリーの変更もクリアしたい場合は、```--hard```オプションを使います。
```
$ git reset --hard HEAD
```

```--hard``` をつけるとクリアされてしまった修正は消えてしまうので注意です。


## 2. commitを戻す

commitまで変更できるのがgitのすごいところです。

commitを変更する＝履歴を書き換える    
ということが何を意味するのか、しっかり理解した上で作業してください。    
大事な事なので２回言いました。

まず修正をコミットします。

```
$ git commit -m "どうせ消しちゃうんでしょ"
```

commitを戻すときも、```git reset```コマンドを使います。

```
$ git reset HEAD^
```

これで、ひとつ前のリビジョンまで戻り、差分はaddする前の状態になります。

他にも```--soft``` ```---hard```オプションの挙動を比較してみましょう。

```
$ git reset --soft HEAD^
$ git reset HEAD^
$ git reset --hard HEAD^
```

## 3. 特定のリビジョンまで戻す

```HEAD^``` と同様に、リビジョン番号を指定する事でできます。

```
$ git reset <revision>
```

```git checkout```とどう違うのでしょう。

```
$ git checkout  <revision>
```

```git status```でブランチ名を確認するとよくわかります。ブランチ名の表記が違いますね。    
```git reset```では、戻した後の状態がブランチのHEADになります。    
一方```git chekout```では、特定のリビジョンをHEADとして移動するだけです。

これで、```add```,```commit```,```reset```を使って、戻したりやり直したりができるようになりました。


## 4. 一つ前のコミットを修正する

あ、この修正忘れてた！いっけねぇ〜うっかり(・ω<)てへぺろ ということは良くあります。    
そんなときは、直前のコミットを修正できる```--amend```オプションを使いましょう。

```
$ git add <filename>
$ git commit --amend
```

addされた修正が直前のコミットに含まれます。

コミットメッセージだけ変更したい場合は、addの無い状態でamendしましょう。

```
$ git commit --amend -m "メッセージ変えます"
```

注目したいのは、amendの前後で、リビジョン番号が変わっている事です。

```
$ git log -1
```

これは、直前のコミットが修正されたのではなく、    
直前のコミットが新しいコミットに差し替えられた、という表現の方がイメージしやすいでしょう。

```
A---B---C---D
```

```
A---B---C   D
         \
          D'
```

履歴を書き換えるということが何を意味するのか、しっかり理解し(ry


## 5. 以前のコミットを打ち消す

特定のコミットの修正に問題があったため、元に戻したいことが良くあります。    
しかしそのコミットはすでにいくつかリビジョンが以前のコミットであるときは、   
コミットを
打ち消す```git revert```を使います。

コミットの内容を見る場合は、```git show```などを使います。

```
$ git show <revision>
```

指定したリビジョンの修正を打ち消す修正がコミットされます。プラマイゼロです。

```
$ git revert <revision>
```

```git revert```は自動でコミットされます。コミットしたくない場合は```--no-commit```オプションを使いましょう。

```
$ git revert --no-commit <revision>
```

## 6. 特定のファイルだけ指定のリビジョンに戻す

あるファイルだけ、指定のリビジョンの状態にしたいことも良くあります。
その場合はファイル名を引数にとって、```git checkout```コマンドを実行します。

```
$ git checkout <revision> <filename>
```

## 参考サイト

> git reset についてもまとめてみる - murankの日記
> http://d.hatena.ne.jp/murank/20110327/1301224770



<br>
[INDEX](https://gist.github.com/yatemmma/6486028#file-git-lesson-md) | [TOP](https://gist.github.com/yatemmma/6486028#file-git-lesson3-md)